<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interactive Paver Planner</title>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 10px; }
    canvas { border: 2px solid #333; background: #eee; max-width:100%; height:auto; touch-action:none; }
    #controls { display:flex; flex-wrap:wrap; justify-content:center; margin-top:10px; gap:10px; }
    button,label { padding:10px; font-size:14px; flex:1 1 140px; }
    #colorPicker { width:100%; height:40px; border:none; margin-top:5px; cursor:pointer; }
    .color-group { display:flex; flex-direction:column; align-items:center; flex:1 1 140px; }
  </style>
</head>
<body>

  <h3>DIRT PROS OF NORTH FLORIDA</h3>
  <h2>Mark Where You Want the Pavers Installed</h2>

  <canvas id="canvas" width="800" height="600"></canvas>

  <div id="controls">
    <button onclick="setMode('line')">Draw Line</button>
    <button onclick="setMode('rect')">Draw Rectangle</button>
    <button onclick="setMode('free')">Draw Freeform</button>
    <div class="color-group">
      <label for="colorPicker">Color Picker</label>
      <input type="color" id="colorPicker" value="#ff0000"/>
    </div>
    <button onclick="setMode('none')">Stop Drawing</button>
    <button onclick="undo()">Undo</button>
    <button onclick="saveImage()">Save</button>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const colorPicker = document.getElementById('colorPicker');
    let mode = 'none', drawing=false, startX, startY;
    let currentFreeform = [], shapes=[];

    const img = new Image();
    img.onload = () => {
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    };
    img.src = "https://dirtpros.github.io/tool/yard.jpg"; // <-- Replace yard.jpg with your actual filename

    function setMode(m) { mode = m; }

    function getPos(e) {
      const r = canvas.getBoundingClientRect();
      const x = e.touches ? e.touches[0].clientX - r.left : e.clientX - r.left;
      const y = e.touches ? e.touches[0].clientY - r.top : e.clientY - r.top;
      return { x, y };
    }

    function startDraw(e) {
      if (mode==='none') return;
      drawing=true;
      const p = getPos(e);
      startX=p.x; startY=p.y;
      if (mode==='free') currentFreeform=[{x:p.x,y:p.y}];
    }

    function moveDraw(e) {
      if (!drawing || mode!=='free') return;
      const p=getPos(e);
      currentFreeform.push({x:p.x,y:p.y});
      ctx.beginPath();
      const ps = currentFreeform;
      ctx.moveTo(ps[ps.length-2].x, ps[ps.length-2].y);
      ctx.lineTo(p.x, p.y);
      ctx.strokeStyle = colorPicker.value; ctx.lineWidth = 2; ctx.stroke();
    }

    function endDraw(e) {
      if (!drawing) return;
      drawing=false;
      const p = getPos(e);
      if (mode==='line') shapes.push({type:'line',x1:startX,y1:startY,x2:p.x,y2:p.y,color:colorPicker.value});
      else if (mode==='rect') shapes.push({type:'rect',x:startX,y:startY,w:p.x-startX,h:p.y-startY,color:colorPicker.value});
      else if (mode==='free') shapes.push({type:'free',points:[...currentFreeform],color:colorPicker.value});
      redraw();
    }

    function redraw(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.drawImage(img,0,0,canvas.width,canvas.height);
      shapes.forEach(s=>{
        ctx.strokeStyle=s.color; ctx.lineWidth=2;
        if(s.type==='line'){
          ctx.beginPath(); ctx.moveTo(s.x1,s.y1); ctx.lineTo(s.x2,s.y2); ctx.stroke();
        } else if(s.type==='rect'){
          ctx.strokeRect(s.x,s.y,s.w,s.h);
        } else if(s.type==='free'){
          ctx.beginPath();
          for(let i=1;i<s.points.length;i++){
            ctx.moveTo(s.points[i-1].x,s.points[i-1].y);
            ctx.lineTo(s.points[i].x,s.points[i].y);
          }
          ctx.stroke();
        }
      });
    }

    function undo(){ shapes.pop(); redraw(); }
    function saveImage(){
      const a=document.createElement('a');
      a.download='marked-yard.png'; a.href=canvas.toDataURL();
      a.click();
      setTimeout(()=>alert('âœ… Please screenshot or send the photo back to us.'),500);
    }

    canvas.addEventListener('mousedown',startDraw);
    canvas.addEventListener('mousemove',moveDraw);
    canvas.addEventListener('mouseup',endDraw);
    canvas.addEventListener('touchstart',e=>{e.preventDefault();startDraw(e)});
    canvas.addEventListener('touchmove',e=>{e.preventDefault();moveDraw(e)});
    canvas.addEventListener('touchend',e=>{e.preventDefault();endDraw(e)});
  </script>

</body>
</html>
